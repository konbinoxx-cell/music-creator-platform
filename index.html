addNoteToStaffFromPiano(noteName) {
    const staff = document.getElementById('staff');
    const staffHeight = staff.offsetHeight;
    
    const noteNumber = this.noteToNumber(noteName);
    const minNote = 48; // C3
    const maxNote = 84; // C6
    
    if (noteNumber >= minNote && noteNumber <= maxNote) {
        const noteRange = maxNote - minNote;
        // 提高整体位置：从20%开始，到80%结束
        const relativePosition = (noteNumber - minNote) / noteRange;
        const y = staffHeight * (0.8 - relativePosition * 0.6); // 从80%到20%
        
        this.createNoteElement(noteName, this.currentX, y);
        this.currentX += this.noteSpacing;
        
        if (this.currentX > (this.measures.length * this.measureWidth - 50)) {
            this.addNewMeasure();
        }
        
        this.updateStatus(`Added note: ${noteName} 添加音符: ${noteName}`);
    } else {
        this.updateStatus(`Note ${noteName} is outside staff range 音符 ${noteName} 超出五线谱范围`);
    }
}

getNotePositions() {
    const staff = document.getElementById('staff');
    const staffHeight = staff.offsetHeight;
    
    const notes = [
        'C6', 'B5', 'A5', 'G5', 'F5', 'E5', 'D5', 'C5',
        'B4', 'A4', 'G4', 'F4', 'E4', 'D4', 'C4',
        'B3', 'A3', 'G3', 'F3', 'E3', 'D3', 'C3'
    ];
    
    const positions = [];
    const totalNotes = notes.length;
    
    notes.forEach((note, index) => {
        // 提高整体位置：从20%开始，到80%结束
        const y = staffHeight * (0.2 + (index / totalNotes) * 0.6);
        positions.push({ note, y });
    });
    
    return positions;
}
